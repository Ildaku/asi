{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title mb-0">üîç –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ —Å –∏—Ö —Ö–µ—à–∞–º–∏ –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                    <th>Email</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–ê–∫—Ç–∏–≤–µ–Ω</th>
                                    <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                    <th>–•–µ—à –ø–∞—Ä–æ–ª—è</th>
                                    <th>–î–ª–∏–Ω–∞ —Ö–µ—à–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>
                                        <strong>{{ user.username }}</strong>
                                        {% if user.username == 'admin' %}
                                            <span class="badge bg-primary ms-2">ADMIN</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ user.email or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                                    <td>
                                        <span class="badge {% if user.role == 'ADMIN' %}bg-danger{% else %}bg-success{% endif %}">
                                            {{ user.role or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if user.is_active %}
                                            <span class="badge bg-success">–î–∞</span>
                                        {% else %}
                                            <span class="badge bg-danger">–ù–µ—Ç</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ user.created_at[:10] if user.created_at else '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}</td>
                                    <td>
                                        <div class="text-break" style="max-width: 300px;">
                                            <small class="text-muted">{{ user.hashed_password[:50] }}...</small>
                                            <button class="btn btn-sm btn-outline-secondary ms-2" 
                                                    onclick="copyToClipboard('{{ user.hashed_password }}')"
                                                    title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ö–µ—à">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ user.password_length }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h5>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                <span class="badge bg-primary rounded-pill">{{ users|length }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
                                <span class="badge bg-danger rounded-pill">
                                    {{ users|selectattr('role', 'equalto', 'ADMIN')|list|length }}
                                </span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –û–ø–µ—Ä–∞—Ç–æ—Ä—ã
                                <span class="badge bg-success rounded-pill">
                                    {{ users|selectattr('role', 'equalto', 'OPERATOR')|list|length }}
                                </span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <h5>üí° –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–∫–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</h5>
                        <div class="alert alert-warning">
                            <ol>
                                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ö–µ—à –ø–∞—Ä–æ–ª—è —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç <code>add_new_user.py</code> —Å —Ç–µ–º –∂–µ –ø–∞—Ä–æ–ª–µ–º</li>
                                <li>–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ Python shell —Å —Ç–µ–º –∂–µ —Ö–µ—à–µ–º</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const button = event.target.closest('button');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i>';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(function(err) {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
        alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
    });
}
</script>
{% endblock %} 